# Branching / merging / commit strategy configuration
# These rules inform what is allowed to be merged/committed and what
# automated actions should run after certain events.
# Can be consumed by hooks/pre-receive.mjs or other repository scripts
allowedOrigins:
  - "https://github.com/clevertree/relay-template/"
allowPullFrom:
  - "https://github.com/clevertree/relay-template/"
sources:
  # Named upstream sources that this repo can pull from
  - name: template
    url: https://github.com/clevertree/relay-template/
branchRules:
  # The default rule applies to any branch not explicitly listed in `branches` below
  default:
    # By default, require signed commits. Any key in .ssh/* is allowed
    requireSigned: true
    allowedKeys:
      - ".ssh/*"
  branches:
    # main branch rules
    - name: main
      rule:
        # Only allow commits that are either:
        #  A) signed by the specific public key in the template repo, or
        #  B) pulled directly from the source origin below
        requireSigned: true
        allowedKeys:
          - ".ssh/id_rsa.pub"
    # public branch rules
    - name: public
      rule:
        # Anyone can modify without a key
        allowUnsigned: true
# Auto-push runs asynchronously and should not block the commit path
autoPush:
  # Branches that should be auto-pushed to all peers after commits/merges
  branches: [ "main", "staging", "develop" ]
  # The origin list for auto-syncing
  originList:
    - "node-dfw1.relaynet.online"
    - "node-dfw2.relaynet.online"
  # Optional debounce to coalesce rapid successive commits
  debounceSeconds: 2
hooks:
  github:
    # Enable a webhook endpoint that GitHub can call on pushes
    enabled: true
    # Relative HTTP path that the relay server or hooks docker exposes
    path: "/hooks/github"
    # Name of env var carrying the shared secret set in the GitHub webhook
    # secretEnv: "RELAY_GITHUB_WEBHOOK_SECRET"
    # Events we listen to (push is enough to trigger pulls)
    events: [ "push" ]
    # When a push happens on the upstream origin, trigger a pull on these branches
    pullOn:
      origins: [ "https://github.com/clevertree/relay-template/" ]
      branches: [ "*" ]
